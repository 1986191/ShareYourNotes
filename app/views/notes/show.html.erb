<%= render "layouts/header" %>
<p id="notice"><%= notice %></p>

<div class="mx-5 p-5 rounded border shadow bg-body">

  <div class="d-flex flex-row">
    <div class="w-75">
      <% if @note.pdf.present? %>
        <div class="pdf-container ratio ratio-16x9">
          <% @note.pdf.each do |pdf| %>
            <!--<a href="<%= pdf.url %>">Scarica il PDF</a>. <!-- Inutile, esiste giÃ  la funzione di download dell'iFrame --> -->
            <iframe src="<%= pdf.url %>", class="rounded shadow bg-body" >
            </iframe>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="d-flex flex-column w-25 ps-5 pb-3">
    
      <div class="d-flex flex-column bb-dashed">
        <h4 class="text-dark"><i class="text-dark"><%= @note.title %></i></h4>
      </div>

      <div class="d-flex flex-column bb-dashed mt-1">
        <div>
          <strong>Owner:</strong>
          <%= link_to @note.user.username, user_path(@note.user) %>
        </div>

        <div>
          <strong>Course:</strong>
          <%= @note.course.name %>
        </div>
      </div>

      <!-- Reviews viewer, maybe create a partial view for it -->
      <div class="container py-3 px-0 m-0">
          <% if @reviews.present? %>
            <% @reviews.take(5).each do |review| %>
              <div class="rounded border m-1 p-3 d-flex flex-column" style="height: 15vh;">
                <h5 class="border-0 m-0 p-0"><i><%= review.title %></i></h5>

                <div class="flex-row">
                  <% for a in 1..review.rating do %>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#F1C40F" class="bi bi-star-fill" viewBox="0 0 16 16">
                      <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                    </svg>
                  <% end %>
                  <% for a in review.rating..4 do %>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
                      <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
                    </svg>
                  <% end %>
                </div>

                <p><%= review.text %></p>
              </div>
            <% end %>
          <% end %>
      </div>

      <div class="d-flex flex-column mt-auto pt-3 bt-dashed">
        <div class="d-flex w-100">
          <%= link_to 'View Reviews', note_reviews_path(@note), class: "btn btn-outline-primary m-1 w-50" %>
          <!-- Button trigger modal -->
          <a type="button" class="btn btn-outline-primary m-1 w-50" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
            Report Note
          </a>
          <%= render "layouts/report_form" %>
        </div>

        <div class="d-flex w-100">
          <% if current_user %>
            <%= link_to 'Leave a Review', new_note_review_path(@note), class: "btn btn-outline-primary m-1 w-50" %>
          <% end %>
          <% if current_user && (current_user.has_role?(:admin) || current_user == @note.user) %> 
            <%= button_to 'Destroy', @note, method: :delete, data: { confirm: 'Are you sure?'}, form_class: 'border-0 w-50 m-1', class: "btn btn-danger w-100" %>
          <% end %>
        </div>
      </div>
    </div>

  </div>
</div>

<%= link_to 'Back', notes_path, class:"btn btn-primary m-5" %>